# CVE-2023-49990

**Issue**

[https://github.com/espeak-ng/espeak-ng/issues/1824](https://github.com/espeak-ng/espeak-ng/issues/1824)

**Poc**

[https://github.com/SEU-SSL/Poc/blob/main/espeak-](https://github.com/SEU-SSL/Poc/blob/main/espeak-ng/id_000064%2Csig_11%2Csrc_008778%2Cop_havoc%2Crep_2)[ng/id_000064%2Csig_11%2Csrc_008778%2Cop_havoc%2Crep_2](https://github.com/SEU-SSL/Poc/raw/refs/heads/main/espeak-ng/id_000064,sig_11,src_008778,op_havoc,rep_2)

**Fix**

[https://github.com/espeak-ng/espeak-ng/pull/1846/commits/e79405772cecf47053116aeaad10e64606292b14](https://github.com/espeak-ng/espeak-ng/pull/1846/commits/e79405772cecf47053116aeaad10e64606292b14)

**Crash stack**

```cpp
    #0 0x7ffff77014e6 in SetUpPhonemeTable src/libespeak-ng/synthdata.c:345
    #1 0x7ffff77016f1 in SelectPhonemeTable src/libespeak-ng/synthdata.c:363
    #2 0x7ffff771dbea in TranslateWord2 src/libespeak-ng/translate.c:1579
    #3 0x7ffff77264fd in TranslateClause src/libespeak-ng/translate.c:2637
    #4 0x7ffff771086b in SpeakNextClause src/libespeak-ng/synthesize.c:1569
    #5 0x7ffff76f822e in Synthesize src/libespeak-ng/speech.c:492
    #6 0x7ffff76f8acf in sync_espeak_Synth src/libespeak-ng/speech.c:570
    #7 0x7ffff76f9076 in espeak_ng_Synthesize src/libespeak-ng/speech.c:678
    #8 0x7ffff76ce40c in espeak_Synth src/libespeak-ng/espeak_api.c:90
    #9 0x55555555b550 in main src/espeak-ng.c:746
```

`phoneme_tab_list` 元素数量 = 7200 / 48 = 150

而访问的number是152

```cpp
extern PHONEME_TAB_LIST phoneme_tab_list[N_PHONEME_TABS];
#define N_PHONEME_TABS     150     // number of phoneme tables
```

![image.png](image%203.png)

**有一个bug，就是经常会有main到某一个函数的链条断掉，暂时还没有解决**

其实就是一个无效的语音输入

![image.png](image%204.png)

第三次调用的时候会爆炸

![image.png](image%205.png)

这里面的pw就是用户输入

![image.png](image%206.png)

被一段一段分析

在TranslateWord → TranslateWord3里面，调用链条非常长，但是本质上就是加了一层过滤

这里面word就是user的输入