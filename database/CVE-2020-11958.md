# CVE-2020-11958

**issue**

[https://blogs.gentoo.org/ago/2020/04/19/re2c-heap-overflow-in-scannerfill-scanner-cc/](https://blogs.gentoo.org/ago/2020/04/19/re2c-heap-overflow-in-scannerfill-scanner-cc/)

**PoC**

119.crashes.re.txt

[https://github.com/skvadrik/re2c/files/4512299/119.crashes.re.txt](https://github.com/skvadrik/re2c/files/4512299/119.crashes.re.txt)

**Patch**

https://github.com/skvadrik/re2c/commit/c4603ba5ce229db83a2a4fb93e6d4b4e3ec3776a

**crash stack**

```cpp
==111710==ERROR: AddressSanitizer: heap-buffer-overflow on address 0x629000004212 at pc 0x7f68d6e47681 bp 0x7fffe25192e0 sp 0x7fffe2518a90
WRITE of size 18 at 0x629000004212 thread T0
    #0 0x7f68d6e47680 in __interceptor_memset ../../../../src/libsanitizer/sanitizer_common/sanitizer_common_interceptors.inc:799
    #1 0x5de564 in re2c::Scanner::fill(unsigned long) ../src/parse/scanner.cc:167
    #2 0x5e3c8b in re2c::Scanner::echo(re2c::Output&) src/parse/lex.cc:87
    #3 0x59cad9 in re2c::compile(re2c::Scanner&, re2c::Output&, re2c::Opt&) ../src/compile.cc:148
    #4 0x49ec60 in main ../src/main.cc:33
    #5 0x7f68d6c46249 in __libc_start_call_main ../sysdeps/nptl/libc_start_call_main.h:58
    #6 0x7f68d6c46304 in __libc_start_main_impl ../csu/libc-start.c:360
    #7 0x49e880 in _start (/home/shangzhixu/shangzhi/RootCauseAnalyzer/gdb_test/RealWorldTest/CVE-2020-11958/re2c/__build_asan/re2c+0x49e880)
```

**Root cause**

Have .re files inside, skip

**EDG**

```
Node _start
__libc_start_main_impl 1

Node __libc_start_main_impl
__libc_start_call_main 1

Node __libc_start_call_main
main 1

Node main
re2c::compile 1

Node re2c::compile
re2c::Scanner::echo 1

Node re2c::Scanner::echo
re2c::Scanner::fill 1

Node re2c::Scanner::fill
memset 1
```

